<html>
<head>
<title>This sucked</title>
</head>
<body>
<?php

//opens the file and makes into a 2 dimensional array
$file = fopen("patients.txt", 'r');

$array = explode("\n", fread($file, filesize("patients.txt")));

$total = sizeof($array);

for ($i = 0; $i < $total; $i++) {
	$array[$i] = explode(",", $array[$i]);
}

$total2 = sizeof($array[0]);

//connects to the sql server
$con = mysql_connect("localhost", username, password);
mysql_select_db("test") or die(mysql_error());

if (!$con) {
	die('Could not connect: ' . mysql_error());
}

//creates database
mysql_query("CREATE DATABASE my_db", $con);

mysql_select_db("my_db", $con);
$sql = "CREATE TABLE Patients
{
id INT NOT NULL, 
PRIMARY KEY(id),
sex VARCHAR(30), 
bloodType VARCHAR(4),
weight DOUBLE,
infected VARCHAR(1))}";

//Inserts into a datbase each patient
for ($i = 0; $i < $total; $i++) {
	mysql_query("INSERT INTO Patients (id, sex, bloodType,
		  weight, infected) 
		  VALUES (" . $array[i][0] . ", " . $array[i][1] .  
		   ", " . $array[i][2] . ", " . $array[i][3] . ", " . 
	       $array[i][4] .  ")");
}

$getAll = mysql_query("SELECT * FROM PATIENTS WHERE sex = 'M'");
$virusFree = mysql_query("SELECT * FROM Patients WHERE infected = 'Y'");

$totalInfected = 0;
$totalWeight = 0;
$infectedBlood = 0;
$infectedAllBlood = 0;
$infectedMale = 0;
$totalMale = 0;

while ($row = mysql_fetch_array($virusFree)) {
	$totalInfected++;
	if ($row['weight'] > 160)
	   $totalWeight++;
	if ($row['bloodType'] == 'O+')
	   $infectedBlood++;
	if ($row['bloodType'] == 'O+' || $row['bloodType'] == 'A+' ||
	   $row['bloodType'] == 'B+' || $row['bloodType'] == 'AB+')
	   $infectedAllBlood++;
}

while ($row2 = mysql_fetch_array($getAll)) {
	$totalMale++;
	if ($row2['infected'] == 'Y')
	   $infectedMale++;
}	   

$percentInfectedMale = $infectedMale/$total;
$nonInfectedMales = $totalInfected - $infectedMale;
$percentNonInfectedMales = $nonInfectedMales/$total;
$percentTotalWeight = $totalWeight / $total;
$percentInfected = totalInfected/$total;
$percentNotInfected = (total - totalInfected) / total;
$percentInfectedBlood = $infectedBlood / $total;
$percentInfectedAllBlood = $infectedAllBlood / $total;

echo "Percent infected: " . $percentInfected . "%\n";
echo "Percent not infected: " . $percentNotInfected . "%\n";
echo "Percent of males infected: " . $percentInfectedMale . "%\n";
echo "Percent non infected males: " . $percentNonInfectedMales . "%\n";
echo "Percent of infected patients over 160 pounds: " . $percentTotalWeight
    . "%\n";
echo "Percent of infected patients with O+ blood type: " . 
    $percentInfectedBlood . "%\n";
echo "Percent of infected patients with positive blood type: " . 
    $percentInfectedAllBlood . "%\n";  
?>
</body>
</html>
